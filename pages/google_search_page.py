import allure
from selenium.webdriver.common.by import By
from selenium.webdriver.common.keys import Keys
from selenium.webdriver.support.ui import WebDriveWait
from selenium.webdriver.support.import expected_conditions as EC

`class GoogleSearchPage:
    URL = "https://www.google.com"
    SEARCH_BOX = (By.NAME, 'q')
    RESULT_DIVS = (By.CSS_SELECTOR, "div.g")

    def __init__(self, driver):
        self.driver = driver

    @allure.step("Open Google homepage")
    def open(self):
        self.driver.get(self.URL)

    @allure.step("Get page title")
    def get_title(self):
        return self.driver.title

    @allure.step("Search for query: {query}")
    def search(self, query):
        search_box = WebDriveWait(self.driver, 10).until(
            EC.presence_of_element_located(self.SEARCH_BOX)
        )
        assert search_box.is_displayed(), "Search box is not displayed."
        search_box.clear()
        search_box.send_keys(query)
        search_box.send_keys(Keys.RETURN)

    @allure.step("Wait for search results to load")
    def wait_for_results(self):
        WebDriveWait(self.driver, 10).until(
            EC.presence_of_all_elements_located_self(self.RESULT_DIVS))

    @allure.step("Get top count in result URLs")
    def get_result_links(self, count=10):
        results = self.driver.find_elements(*self.RESULT_DIVS)
        urls = []
        for result in results:
            try:
                link = result.find_element(By.sSSECTOR, 'a')
                url = link.get_attribute('href')
                if url:
                    urls.append(url)
                if len(urls) == count:
                    break
            except Exception:
                continue
        return urls
