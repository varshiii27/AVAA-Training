aW1wb3J0IGFsbHVyZQpmcm9tIHNlbGVuaXVtLndlYmdyaXZlci5jb21tb24uYnkgaW1wb3J0IEJ5CmZyb20gc2VsZW5pdW0ud2ViZ3JpdmVyLmNvbW1vbi5rZXlzIGltcG9ydCBLZXlzCmZyb20gc2VsZW5pdW0ud2ViZ3JpdmVyLnN1cHBvcnQudWkgaW1wb3J0IFdlYkRyaXZlcldhaXQKZnJvbSBzZWxlbml1bS53ZWJkcml2ZXIuc3VwcG9ydC5leHBlY3RlZF9jb25kaXRpb25zIGltcG9ydCBFQwoKY2xhc3MgR29vZ2xlU2VhcmNoUGFnZToKICAgIFNFQVJDSF9CT1ggPSAoQnkuTkFNRSwgInEiKQogICAgQ09OU0VOVF9CVE4gPSAoQnkuWFBBVEgsICIvL2J1dHRvbltj
b250YWlucyguLCAnSSBhZ3JlZScpIG9yIGNvbnRhaW5zKC4sICdBY2NlcHQgYWxsJyddKSIpCiAgICBSRVNVTFRfTElOS1MgPSAoQnkuQ1NTU0VMRUNUT1IsICJkaXYjc2VhcmNoIGE
iKQoKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBkcml2ZXIpOgogICAgICAgIHNlbGYuZHJpdmVyID0gZHJpdmVyCiAgICAgICAgc2VsZi53YWl0ID0gV2ViRHJpdmVyV2FpdChk
cml2ZXIsIDEwKQoKICAgIEBhbGx1cmUuc3RlcCgiT3BlbiBHb29nbGUgaG9tZXBhZ2UiKQogICAgZGVmIG9wZW4oc2VsZik6CiAgICAgICAgc2VsZi5kcml2ZXIuZ2V0KCJodHRwczovL3d3dy5nb29nbGUuY29tIikKCiAgICBAYWxsdXJlLnN0ZXAoIkFjY2VwdCBjb29raWVzIGlmIGNvbnNlbnQgZm9ybSBhcHBlYXJzIikKICAgIGRlZiBhY2NlcHRfY29va2llcyhzZWxmKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIGNvbnNlbnRfYnV0dG9uID0gV2ViRHJpdmVyV2FpdChzZWxmLmRyaXZlc
iwgMykudW50aWwoCiAgICAgICAgICAgICAgICBFQy5lbGVtZW50X3RvX2JlX2NsaWNrYWJsZShzZWxmLkNPTlNFTlRfQlROKQogICAgICAgICAgICApCiAgICAgICAgICAgIGNvbnNlbnRfYnV0dG9uLmNsaWNrKCkKICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICBwYXNzCgogICAgQGFsbHVyZS5zdGVwKCJTZWFyY2ggZm9yICd7cXVlcnl9JyIpCiAgICBkZWYgc2VhcmNoKHNlbGYsIHF1ZXJ5KToKICAgICAgICBzZWFyY2hfYm94ID0gc2VsZi53YWl0LnVudGlsKEVDLnByZXNlbmNlX29mX2VsZW1lbnRfbG9jYXRlZChzZWxmLlNFQVJDSF9CT1gpKQogICAgICAgIHNlYXJjaF9ib3guc2VuZF9rZXlzKHF1ZXJ5KQogICAgICAgIHNlYXJjaF9ib3guc2VuZF9rZXlzKEtleXMuUkVUVVJOKQoKICAgIEBhbGx1cmUuc3RlcCgiR2V0IGZpcnN0IHtjb3VudH0gdmFsaWQgcmVzdWx0IFVSTHMiKQogICAgZGVmIGdldF9yZXN1bHRfbGlua3Moc2VsZiwgY291bnQsIGlzX3ZhbGlkX3VybCk6CiAgICAgICAgc2VsZi53YWl0LnVudGlsKEVDLnByZXNlbmNlX2FsbF9lbGVtZW50c19sb2NhdGVkKHNlbGYuUkVTVUxUX0xJTktTKSkKICAgICAgICByZXN1bHRzID0gc2VsZi5kcml2ZXIuZmluZF9lbGVtZW50cygq
c2VsZi5SRVNVTFRfTElOS1MpCiAgICAgICAgdXJscyA9IFtdCiAgICAgICAgZm9yIHJlc3VsdCBpbiByZXN1bHRzOgogICAgICAgICAgICBocmVmID0gcmVzdWx0LmdldF9hdHRyaWJ1dGUoImhyZWYiKQogICAgICAgICAgICBpZiBocmVmIGFuZCBpc192YWxpZF91cmwocmVmKToKICAgICAgICAgICAgICAgIHVybHMuYXBwZW5kKGhyZWYpCiAgICAgICAgICAgIGlmIGxlbih1cmxzKSA9PSBjb3VudDoKICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgcmV0dXJuIHVybHMK